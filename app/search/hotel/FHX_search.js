/**BuildTime: Thursday, December 19, 2013
 *If you found any bug, please mail to shiz@ctrip.com*/
(function(){var S={format:function(e){var t=arguments;return t.length==0?e:e.replace(/\$(\d)/g,function(e,n){return t[n]==undefined?"":t[n]})},dateDiff:function(e,t,n,r){$.type(e)!=="date"&&(e=e.toDate()),$.type(t)!=="date"&&(t=t.toDate());var i=Math.abs(e.getTime()-t.getTime());switch(n){case"S":return i;case"s":return Math.round(i/1e3);case"m":return Math.round(i/1e3/60);case"h":return Math.round(i/1e3/60/60);case"d":return Math.round(i/1e3/60/60/24);case"M":return Math.abs((e.getFullYear()-t.getFullYear())*12+(e.getMonth()-t.getMonth()));case"y":return Math.abs(e.getFullYear()-t.getFullYear());default:return null}}},Mod={showTips:function(e,t,n){return Mod.formValidator||(Mod.formValidator=$(document).regMod("validate","1.1")),typeof e.bind!="function"&&(e=$(e)),Mod.formValidator.method("show",{$obj:e,data:t,removeErrorClass:!0,hideEvent:n||"blur",isFocus:!0,isScroll:!1}),!1}};(function(exports){function t(){var e=$.fn.value;$.fn.value=function(t){var n=this,r=this[0];if(!r)return"";var i=r.getAttribute("placeholder");if(!i)return e.call(n,t);if(typeof t=="undefined")return r.value==i?"":r.value;t.trim()==""||t.trim()==i?(r.value=i,r.style.color="gray"):(r.value=t,r.style.color="")}}var e="placeholder"in document.createElement("input"),n=function(e,t){e[0].value.trim()==""&&(e[0].value=t),this.txt=e,this.msg=t,e[0].setAttribute("placeholder",t),e[0].value==t&&e.css({color:"gray"}),e.bind("focus",this.hide.bind(this)).bind("blur",this.show.bind(this))};n.prototype={show:function(){var e=this.txt;if(this.msg==e[0].value||e[0].value.trim()=="")e[0].value=this.msg,e[0].style.color="gray"},hide:function(){var e=this.txt;this.msg==e[0].value&&(e[0].value="",e[0].style.color="")}},exports.regPlaceHolder=function(r,i){if(!r)return;if(!i)return;typeof r.value!="function"&&(r=$(r));if(!r[0])return;e?r[0].placeholder=i:(new n(r,i),t())}})(Mod);var e={checkAddress:function(e,t){if(t){if(!e.value().trim())return Mod.showTips(e,FHXConfig.validate[8]);if(!t.value().trim())return Mod.showTips(t,FHXConfig.validate[9]);if(e.value().trim()==t.value().trim())return Mod.showTips(t,FHXConfig.validate[13])}else if(!e.value().trim())return Mod.showTips(e,FHXConfig.validate[10]);return!0},checkDate:function(e,t,n,r){var i=e.value(),s=t.value();if(n){var o=n.value(),u=r.value();if(o=="")return Mod.showTips(n,FHXConfig.validate[2]);if(u=="")return Mod.showTips(r,FHXConfig.validate[3]);if(!o.isDate())return Mod.showTips(n,FHXConfig.validate[4]);if(!u.isDate())return Mod.showTips(r,FHXConfig.validate[4]);if(o>=u)return Mod.showTips(r,FHXConfig.validate[6]);if(S.dateDiff(o,u,"d")>28)return Mod.showTips(r,FHXConfig.validate[7]);if(o.toDate().addDays(1)<i.toDate())return Mod.showTips(n,FHXConfig.validate[11]);if(s.toDate().addDays(1)<u.toDate())return Mod.showTips(r,FHXConfig.validate[12])}else{if(i=="")return Mod.showTips(e,FHXConfig.validate[0]);if(s=="")return Mod.showTips(t,FHXConfig.validate[1]);if(!i.isDate())return Mod.showTips(e,FHXConfig.validate[4]);if(!s.isDate())return Mod.showTips(t,FHXConfig.validate[4]);if(i>=s)return Mod.showTips(t,FHXConfig.validate[5]);if(S.dateDiff(i,s,"d")>28)return Mod.showTips(t,FHXConfig.validate[7])}return!0}},t={focusNext:!0,validate:function(t){var n=this;this.focusNext=!1;var r=e.checkAddress(n.txtFrom,n.txtTo)&&e.checkDate(n.txtFromDate,n.txtToDate);if(!r)return r;t()},getUrl:function(){return this._hotelCount>1?FHXConfig.URL.FREE_COMBINE:S.format(FHXConfig.URL.SINGLE_FLT_HOTEL,"round",this.hFromPY.value(),this.hFromID.value(),this.hToPY.value(),this.hToID.value()).toLowerCase()},search:function(e){var n=this;t.validate(function(){var e=t.getUrl();n.txtFromDate.attr("value",n.txtFromDate.value()),n.txtToDate.attr("value",n.txtToDate.value());var r=document.createElement("form");r.action=e,r.method="post",r.innerHTML=$("#FHX_SearchBox")[0].innerHTML.replace(/FHX_/g,""),document.body.appendChild(r),r.submit()})},init:function(){if($("#FHX_txtFromDate").length==0)return;this._initFlightMods(),$("#FHX_btnSearch").bind("click",t.search.bind(t))},_initFlightMods:function(){var e=this;["txtFrom","txtTo","txtFromDate","txtToDate"].each(function(t,n){e[t]=$("#FHX_"+t),Mod.regPlaceHolder(e[t],FHXConfig.placeholder[n>1?0:1])});var t="http://flights.ctrip.com/international/tools/GetCities.ashx?s=${key}&a=${type}&t="+($.config("charset")=="big5"?"1":"0"),n=/@([a-zA-Z\s]+)/;e.hFromID=$("#FHX_hFromID"),e.hFromPY=$("#FHX_hFromPY"),e.hToID=$("#FHX_hToID"),e.hToPY=$("#FHX_hToPY");var r=e.txtFrom.regMod("address","1.0",{name:"FHX_txtFrom",jsonpSource:"http://webresource.c-ctrip.com/ResVacationOnline/R9/js/database/flightintl_start_"+cQuery.config("charset")+".js",jsonpFilter:"http://flights.ctrip.com/international/tools/GetCities.ashx?s=${key}&a=1&t="+($.config("charset")=="big5"?"1":"0"),message:FHXConfig.address.message,template:{suggestion:FHXConfig.address.suggestion[0],suggestionStyle:FHXConfig.address.suggestionStyle,suggestionIpad:FHXConfig.address.suggestionIpad[0],suggestionStyleIpad:FHXConfig.address.suggestionStyle,filter:FHXConfig.address.filter,filterStyle:FHXConfig.address.filterStyle}});r.method("bind","change",function(r,i){e.txtFrom[0].value=i.items[1].replace(/\([^\)]+\)/,""),e.txtFrom[0].blur(),$.jsonp(t.replace("${type}",1).replace("${key}",i.value),{onload:function(t){e.hFromID.value(t.data.split("|")[2]);var r=t.data.match(n)[1];e.hFromPY.value(r)}})}),e.txtFrom.address=r,r=e.txtTo.regMod("address","1.0",{name:"FHX_txtTo",jsonpSource:"http://webresource.c-ctrip.com/ResVacationOnline/R9/js/database/flightintl_dest_"+cQuery.config("charset")+".js",jsonpFilter:"http://flights.ctrip.com/international/tools/GetCities.ashx?s=${key}&a=0&t="+($.config("charset")=="big5"?"1":"0"),message:FHXConfig.address.message,template:{suggestion:FHXConfig.address.suggestion[1],suggestionStyle:FHXConfig.address.suggestionStyle,suggestionIpad:FHXConfig.address.suggestionIpad[1],suggestionStyleIpad:FHXConfig.address.suggestionStyle,filter:FHXConfig.address.filter,filterStyle:FHXConfig.address.filterStyle}}),r.method("bind","change",function(r,i){e.txtTo[0].value=i.items[1].replace(/\([^\)]+\)/,""),e.txtTo[0].blur(),$.jsonp(t.replace("${type}",1).replace("${key}",i.value),{onload:function(t){e.hToID.value(t.data.split("|")[2]);var r=t.data.match(n)[1];e.hToPY.value(r)}})}),e.txtTo.address=r;var i=e.txtFromDate.regMod("calendar","3.0",{options:{minDate:(new Date).addDays(1).toStdDateString(),showWeek:!0,container:cQuery.container},listeners:{onChange:function(t,n){e.txtToDate.data("startDate",n.toDate().addDays(1).toStdDateString()),e.txtToDate.data("minDate",n.toDate().addDays(1).toStdDateString()),e.txtToDate.data("maxDate",n.toDate().addDays(28).toStdDateString()),e.focusNext&&e.txtToDate[0].focus()}}});i.method("setWeek",e.txtFromDate[0]),e.txtFromDate.calendar=i,i=e.txtToDate.regMod("calendar","3.0",{options:{minDate:e.txtFromDate.value().toDate().addDays(1).toStdDateString(),maxDate:e.txtFromDate.value().toDate().addDays(28).toStdDateString(),showWeek:!0}}),i.method("setWeek",e.txtToDate[0]),e.txtToDate.calendar=i}};window.FHX={init:function(){$.mod.multiLoad({tab:"1.2",address:"1.0",calendar:"3.0",notice:"1.0",validate:"1.1",dropBox:"1.0"}),t.init()},setWeek:function(){var e=t.txtFromDate,n=t.txtToDate;e.calendar.method("setWeek",e[0]),n.calendar.method("setWeek",n[0])}}})()